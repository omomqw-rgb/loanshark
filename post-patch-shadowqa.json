{
  "version": "v335_cloudstate_latest_snapshot_investigation_and_fix",
  "executed": false,
  "note": "이 파일은 v335 패치 이후 Cloud Load 직후 수행해야 하는 ShadowQA 항목을 정리한 사양(Spec)입니다. 실제 데이터에 대한 결과 값은 브라우저 콘솔에서 App.cloudState.runShadowQA() 또는 runShadowQA('manual')을 호출하여 얻어야 합니다.",
  "checks": {
    "loan_schedule_link": {
      "description": "각 Loan이 최소 1개 이상의 Schedule(loan.kind === 'loan')을 가지고 있는지, 반대로 Schedule.loanId 가 존재하는 Loan.id 를 참조하는지 검사.",
      "source_function": "js/core/cloudState.js::runShadowQA",
      "expected_invariants": [
        "missingLoanScheduleIds.length === 0 (스케줄이 전혀 없는 대출이 없어야 함)",
        "orphanLoanSchedules === 0 (존재하지 않는 Loan.id 를 참조하는 스케줄이 없어야 함)"
      ]
    },
    "claim_schedule_link": {
      "description": "각 Claim이 최소 1개 이상의 Schedule(kind === 'claim')을 가지고 있는지, Schedule.claimId 가 존재하는 Claim.id 를 참조하는지 검사.",
      "source_function": "js/core/cloudState.js::runShadowQA",
      "expected_invariants": [
        "orphanClaimSchedules === 0 (존재하지 않는 Claim.id 를 참조하는 스케줄이 없어야 함)"
      ]
    },
    "id_type_consistency": {
      "description": "Loan / Claim / Schedule / Debtor 의 주요 ID 필드 타입 분포를 수집해 문자열/숫자 혼재 여부를 확인.",
      "source_function": "js/core/cloudState.js::collectTypeStats + runShadowQA",
      "expected_invariants": [
        "App.cloudState.build() / apply() 이후 runShadowQA().idTypeStats.* 에서 각 id 필드는 주로 'string' 타입으로 정규화되어야 함",
        "혼재가 있더라도 normalizeAppDataIds() 이후 Loan.id / Schedule.loanId 등의 매핑은 문자열 기준으로 일관되게 동작"
      ]
    },
    "aggregate_counts": {
      "description": "Cloud Load 이후 App.data 와 App.state 에서 Loan/Claim/Schedule/CashLog 개수가 서로 어긋나지 않는지 확인.",
      "source_function": "js/core/data.js::loadAllFromSupabase + js/core/cloudState.js::apply",
      "expected_invariants": [
        "App.state.debtors.length === App.data.debtors.length",
        "App.state.loans.length === App.data.loans.length",
        "App.state.claims.length === App.data.claims.length",
        "App.state.schedules.length === App.data.schedules.length",
        "App.state.cashLogs.length === App.data.cashLogs.length"
      ]
    }
  },
  "how_to_run": [
    "1) 브라우저에서 로그인 후 Cloud Load 버튼 클릭 또는 자동 로그인 완료까지 대기.",
    "2) 개발자 콘솔에서 App.cloudState.runShadowQA() 를 실행.",
    "3) 반환된 report 객체를 확인하여 missingLoanScheduleIds / orphanLoanSchedules / orphanClaimSchedules 등이 0인지 확인.",
    "4) 필요 시 report.idTypeStats / report.counts 를 바탕으로 데이터 정합성을 추가 점검."
  ]
}